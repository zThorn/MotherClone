var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Wallaby;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.preload=function(){},b.prototype.create=function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.device.desktop&&(this.scale.pageAlignHorizontally=!0),this.game.state.start("Preloader",!0,!1)},b}(Phaser.State);a.Boot=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(b){function c(){b.call(this,800,600,Phaser.AUTO,"content",null),this.state.add("Boot",a.Boot,!1),this.state.add("Preloader",a.Preloader,!1),this.state.add("MainMenu",a.MainMenu,!1),this.state.add("Level",a.Level,!1),this.state.start("Boot")}return __extends(c,b),c}(Phaser.Game);a.Game=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(a){function b(b,c,d,e){a.call(this,b,c,d,"gasStation",0),this.fuel_fill_rate=5,this.score=0,this.cash=0,this.drillLevel=2,this.anchor.setTo(.5,0),this.game.add.existing(this),this.eHover=new Phaser.Sprite(b,this.x+8,this.y-32,"e"),this.game.add.existing(this.eHover),this.eHover.visible=!1,this.player=e}return __extends(b,a),b.prototype.update=function(){this.overlap(this.player)&&(this.eHover.visible=!0,this.game.input.keyboard.isDown(Phaser.Keyboard.E)&&this.player.cash>=5&&this.player.fuel<this.player.fuelTank&&this.fill(this.player)),this.overlap(this.player)||(this.eHover.visible=!1)},b.prototype.fill=function(a){a.fuel+=1,a.cash-=1},b}(Phaser.Sprite);a.GasStation=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.create=function(){this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.physics.arcade.gravity.y=500,this.map=this.add.tilemap("level"),this.map.addTilesetImage("Tiles"),this.map.setCollisionBetween(1,3),this.map.setCollisionBetween(5,8),this.ground=this.map.createLayer("Ground"),this.ground.resizeWorld(),this.player=new a.Player(this.game,32,32),this.gasStation=new a.GasStation(this.game,128,160,this.player),this.vendor=new a.Vendor(this.game,this.player,256,192),this.player.bringToTop(),this.txt=this.game.add.group(),this.txt.fixedToCamera=!0,this.fuelText=this.game.add.text(this.game.world.centerX-475,0,"Fuel: ",{fontSize:"32px",fill:"white",stroke:"black",strokeThickness:5},this.txt),this.scoreText=this.game.add.text(this.game.world.centerX-475,50,"Cash: ",{fontSize:"32px",fill:"white",stroke:"black",strokeThickness:5},this.txt),this.fpsText=this.game.add.text(this.game.world.centerX-475,100,"FPS: ",{fontSize:"32px",fill:"white",stroke:"black",strokeThickness:5},this.txt),this.game.time.advancedTiming=!0,this.drillText=this.game.add.text(this.game.world.centerX-475,150,"Drill: ",{fontSize:"32px",fill:"white",stroke:"black",strokeThickness:5},this.txt),this.pauseText=this.game.add.text(this.game.world.centerX,150,"",{fontSize:"64px",fill:"red"},this.txt),this.camera.follow(this.player),this.populateWorld()},c.prototype.update=function(){this.game.physics.arcade.collide(this.player,this.ground),this.player.body.velocity.x=0,this.player.update(),this.gasStation.update(),this.vendor.update(),this.game.input.mousePointer.isDown&&this.game.input.mousePointer.duration>100*this.player.drillLevel?this.game.input.mousePointer.duration>100*this.player.drillLevel&&this.game.input.mousePointer.duration<100*this.player.drillLevel+50?(this.removeTile(this.game.input.mousePointer.worldX,this.game.input.mousePointer.worldY),this.timeCheck=this.game.time.time):this.game.time.time-this.timeCheck>100*this.player.drillLevel&&(this.removeTile(this.game.input.mousePointer.worldX,this.game.input.mousePointer.worldY),this.timeCheck=this.game.time.time):this.game.input.keyboard.isDown(Phaser.Keyboard.ESC)&&(this.pauseText.text="Paused",this.player.pause=!0,this.game.physics.arcade.gravity.y=0),this.game.input.keyboard.isDown(Phaser.Keyboard.P)&&(this.pauseText.text="",this.player.pause=!1,this.game.physics.arcade.gravity.y=500),this.fuelText.setText("Fuel: "+Math.floor(this.player.fuel).toString()+" / "+this.player.fuelTank.toString()),this.scoreText.setText("Cash: $"+this.player.cash.toString()),this.fpsText.setText("FPS: "+this.game.time.fps.toString()),this.drillText.setText("Drill: "+this.player.drillLevel.toString())},c.prototype.removeTile=function(a,b){a=Math.floor(a/32),b=Math.floor(b/32);var c=this.map.getTile(a,b).index;this.tile=this.map.getTile(a,b),this.player.fuel>0&&9!=this.tile.index&&4!=this.tile.index&&(32<=this.player.x-32*a||32>=32*a-this.player.x)&&(32>=this.player.y-32*b||32<=32*b-this.player.y)&&(console.log(this.tile.index),this.player.cash=this.player.cash+this.getTileValue(c),this.player.fuel--,this.map.putTile(9,a,b))},c.prototype.populateWorld=function(){for(var a=0,b=0;30>b;b++)for(var c=8;100>c;c++)a=Math.random(),a>=.98&&c>=50?this.map.putTile(8,b,c):a>=.94&&c>=30?this.map.putTile(3,b,c):a>=.9&&c>=25?this.map.putTile(2,b,c):a>=.9?this.map.putTile(6,b,c):a>.8&&this.map.putTile(1,b,c)},c.prototype.getTileValue=function(a){var b=0;switch(a){case 1:b=7;break;case 2:b=25;break;case 3:b=35;break;case 4:break;case 5:case 7:b=5;break;case 6:b=10;break;case 8:b=100}return 0!=b&&this.displayTotal(b),b},c.prototype.displayTotal=function(a){var b=this.game.add.text(this.player.x-10,this.player.y-35,"+"+a.toString(),{fontSize:"12px",fill:"white",stroke:"black",strokeThickness:5});b.alpha=1,this.game.add.tween(b).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1),this.game.add.tween(b).to({x:this.player.x-200,y:this.player.y-250},1e3,Phaser.Easing.Linear.None,!0,0,0,!1)},c}(Phaser.State);a.Level=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.create=function(){this.startGame()},b.prototype.fadeOut=function(){},b.prototype.startGame=function(){this.game.state.start("Level",!0,!1)},b}(Phaser.State);a.MainMenu=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d,"player",0),this.fuel=50,this.fuelTank=50,this.score=0,this.cash=0,this.drillLevel=10,this.pause=!1,this.anchor.setTo(.5,0),b.physics.enable(this),this.body.linearDamping=1,this.body.collideWorldBounds=!0,this.body.tilePadding.x=50,this.body.tilePadding.y=50,this.body.maxVelocity.y=250,this.game.add.existing(this)}return __extends(b,a),b.prototype.update=function(){this.pause||(this.body.maxVelocity.y=250,this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)&&this.fuel>1&&(this.body.velocity.y=-250,this.fuel-=.1),this.game.input.keyboard.isDown(Phaser.Keyboard.LEFT)||this.game.input.keyboard.isDown(Phaser.Keyboard.A)?this.body.velocity.x=-150:this.game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)||this.game.input.keyboard.isDown(Phaser.Keyboard.D)?this.body.velocity.x=150:this.game.input.keyboard.isDown(Phaser.Keyboard.TILDE)&&this.restart()),this.fuel<1&&this.restart(),this.pause&&(this.body.maxVelocity.y=0)},b.prototype.restart=function(){this.x=30,this.y=30,this.fuel=this.fuelTank,this.cash=0},b}(Phaser.Sprite);a.Player=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.preload=function(){this.game.load.image("player","assets/player.png"),this.game.load.image("drillUpgrade","assets/drill_upgrade_icon.png"),this.game.load.image("vendor","assets/vendor.png"),this.game.load.image("gasStation","assets/gas_station0.png"),this.game.load.tilemap("level","assets/spritesheet.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.image("Tiles","assets/Tiles.png"),this.game.load.image("shopbackground","assets/sbg.png"),this.game.load.image("buy","assets/buybutton.png"),this.game.load.image("e","assets/e.png")},b.prototype.create=function(){this.startMainMenu()},b.prototype.startMainMenu=function(){this.game.state.start("MainMenu",!0,!1)},b}(Phaser.State);a.Preloader=b}(Wallaby||(Wallaby={}));var Wallaby;!function(a){var b=function(a){function b(b,c,d,e){a.call(this,b,d,e,"vendor",0),this.drill_upgrades=1,this.multiplier=1.5,this.drillCost=100,this.fuelCost=100,this.subAmount=0,this.anchor.setTo(.5,0),this.shopBackground=new Phaser.Sprite(this.game,250,250,"shopbackground"),this.shopBackground.visible=!1,this.shopBackground.fixedToCamera=!0,this.game.add.existing(this.shopBackground),this.drillBuyButton=new Phaser.Button(this.game,585,275,"buy"),this.drillBuyButton.visible=!1,this.drillBuyButton.fixedToCamera=!0,this.game.add.existing(this.drillBuyButton),this.drillBuyButton.inputEnabled=!0,this.drillBuyButton.events.onInputDown.add(function(){this.drillButtonClick(c)},this),this.drillIcon=new Phaser.Sprite(this.game,400,275,"drillUpgrade"),this.drillIcon.visible=!1,this.drillIcon.fixedToCamera=!0,this.game.add.existing(this.drillIcon),this.fuelBuyButton=new Phaser.Button(this.game,585,355,"buy"),this.fuelBuyButton.visible=!1,this.fuelBuyButton.fixedToCamera=!0,this.game.add.existing(this.fuelBuyButton),this.fuelBuyButton.inputEnabled=!0,this.fuelBuyButton.events.onInputDown.add(function(){this.fuelButtonClick(c)},this),this.eHover=new Phaser.Sprite(this.game,this.x-8,this.y-32,"e"),this.game.add.existing(this.eHover),this.eHover.visible=!1,this.eHover.alpha=0,this.player=c,this.game.add.existing(this)}return __extends(b,a),b.prototype.update=function(){this.overlap(this.player)?(this.eHover.visible=!0,this.game.input.keyboard.isDown(Phaser.Keyboard.E)&&this.isVisible(!0)):(this.x+100<this.player.x||this.x-100>this.player.x||this.game.input.keyboard.isDown(Phaser.Keyboard.ESC))&&this.isVisible(!1),this.overlap(this.player)||(this.eHover.visible=!1)},b.prototype.drillButtonClick=function(a){a.cash>=this.multiplier*this.drillCost&&a.drillLevel>=3&&(this.subAmount=Math.floor(this.multiplier*this.drillCost),a.cash-=this.subAmount,this.drillCost=Math.floor(this.multiplier*this.drillCost),this.drill_upgrades+=1,a.drillLevel-=1,this.subtractEffect(this.subAmount))},b.prototype.fuelButtonClick=function(a){a.cash>=this.multiplier*this.fuelCost&&(this.subAmount=Math.floor(this.multiplier*this.fuelCost),a.cash-=this.subAmount,this.fuelCost=Math.floor(this.fuelCost*this.multiplier),a.fuelTank=Math.floor(a.fuelTank*this.multiplier),this.subtractEffect(this.subAmount))},b.prototype.isVisible=function(a){a?(this.shopBackground.visible=!0,this.fuelBuyButton.visible=!0,this.drillBuyButton.visible=!0,this.drillIcon.visible=!0):(this.shopBackground.visible=!1,this.fuelBuyButton.visible=!1,this.drillBuyButton.visible=!1,this.drillIcon.visible=!1)},b.prototype.subtractEffect=function(a){var b=this.game.add.text(this.game.world.centerX-325,50,"-"+a.toString(),{fontSize:"12px",fill:"white",stroke:"black",strokeThickness:5});b.alpha=1,this.game.add.tween(b).to({alpha:0},500,Phaser.Easing.Linear.None,!0,0,0,!1),this.game.add.tween(b).to({x:this.game.world.centerX-305,y:50},1e3,Phaser.Easing.Linear.None,!0,0,0,!1)},b}(Phaser.Sprite);a.Vendor=b}(Wallaby||(Wallaby={})),window.onload=function(){new Wallaby.Game};